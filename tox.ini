[tox]
envlist = py39, py310, py311, py312

[testenv]
deps = -e .[dev]
commands = pytest {posargs}

[testenv:quality]
deps = -e .[quality]
commands = hatch run quality

[testenv:security]
deps = bandit[toml]>=1.7.0
commands = bandit -r src/ -c pyproject.toml

[testenv:type]
deps = mypy>=1.7.0
commands = mypy src/

[testenv:coverage]
deps = -e .[dev]
commands =
    pytest --cov=src/opengov_earlymathematics --cov-report=term-missing --cov-report=html --cov-report=xml

[testenv:benchmark]
deps = -e .[dev]
commands = pytest tests/benchmarks/ --benchmark-only --benchmark-sort=mean

[testenv:property]
deps = -e .[dev]
commands = pytest tests/property/ -v

[testenv:integration]
deps = -e .[dev]
commands = pytest tests/integration/ -v

[testenv:e2e]
deps = -e .[dev]
commands = pytest tests/e2e/ -v

[testenv:docs]
deps = -e .[docs]
changedir = docs
commands =
    mkdocs build

[testenv:build]
deps = build>=1.0.0
commands = python -m build

[testenv:release]
deps = build>=1.0.0
commands =
    python -m build
    twine check dist/*

[testenv:clean]
deps =
commands =
    find . -type d -name __pycache__ -delete
    find . -type d -name "*.egg-info" -exec rm -rf {} +
    find . -type d -name "*.tox" -exec rm -rf {} +
    find . -type d -name ".pytest_cache" -exec rm -rf {} +
    find . -type d -name ".mypy_cache" -exec rm -rf {} +
    find . -type d -name ".ruff_cache" -exec rm -rf {} +
    find . -type f -name "*.pyc" -delete
    find . -type f -name "*.pyo" -delete
    find . -type f -name "*.pyd" -delete